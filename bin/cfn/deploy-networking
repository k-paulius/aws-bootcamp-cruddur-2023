#!/usr/bin/env bash
set -e

DIR_PATH=$(dirname $(readlink -f $0))
CFN_TEMPLATE_FILE="$DIR_PATH/../../aws/cfn/networking/template.yaml"
CFN_STATE_BUCKET=cf-templates-gifqxra91o60

# Cruddur environment: dev, prod
CRUDDUR_ENV="prod"
STACK_NAME="cruddur-$CRUDDUR_ENV-vpc"

cfn-lint $CFN_TEMPLATE_FILE

aws cloudformation deploy \
    --template-file $CFN_TEMPLATE_FILE \
    --stack-name $STACK_NAME \
    --s3-bucket $CFN_STATE_BUCKET \
    --parameter-overrides IPv4Block=20 VPCName=cruddur-$CRUDDUR_ENV
